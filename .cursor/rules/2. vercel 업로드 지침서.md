반응형 웹과 하이브리드 앱을 배포, 리소스를 정리하기 위한 지침서 입니다.
개발 환경에 따라 판단하여 웹 또는 하이브리드 앱 지침에 맞춰 진행해주세요.
깃허브브에서 해당 리소스를 즉시 확인 할 수 있는 환경을 만들어주세요.

A. 웹(Web)용 Vercel 최적화 가이드

목표

Vite 기반 SPA/MPA 또는 순수 정적 사이트를 Vercel에 최적 배포합니다.

SPA 새로고침 404 없이 작동하게 rewrites를 구성합니다.

빌드 산출물(dist)과 정적 자산 캐시를 안전하게 설정합니다.

한국/일본 사용자를 가정해 icn1/hnd1 리전을 우선 적용합니다.

파일 위치
레포 루트에 vercel.json 1개만 둡니다. 모노레포라면 Vercel Project의 Root Directory에 둡니다.

템플릿 모음

A-1) 정적 사이트(다중 HTML, 리라이트 불필요)

{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "public": "public",
  "cleanUrls": true,
  "trailingSlash": false,
  "regions": ["icn1", "hnd1"],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        { "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }
      ]
    },
    {
      "source": "/(.*).html",
      "headers": [
        { "key": "Cache-Control", "value": "no-cache" }
      ]
    }
  ]
}


A-2) Vite 기반 SPA(React/Vue/Svelte)
정적 자산은 예외 처리, 나머지는 index.html로 리라이트합니다.

{
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "cleanUrls": true,
  "regions": ["icn1", "hnd1"],
  "functionFailoverRegion": "hnd1",
  "rewrites": [
    { "source": "/assets/(.*)", "destination": "/assets/$1" },
    { "source": "/(.*)", "destination": "/index.html" }
  ],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        { "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }
      ]
    },
    {
      "source": "/(.*).html",
      "headers": [
        { "key": "Cache-Control", "value": "no-cache" }
      ]
    }
  ]
}


A-3) Vite 기반 MPA(여러 HTML 진입점)

{
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "cleanUrls": true,
  "regions": ["icn1", "hnd1"],
  "rewrites": [
    { "source": "/assets/(.*)", "destination": "/assets/$1" },
    { "source": "/about", "destination": "/about/index.html" },
    { "source": "/contact", "destination": "/contact/index.html" }
  ],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        { "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }
      ]
    },
    {
      "source": "/(.*).html",
      "headers": [
        { "key": "Cache-Control", "value": "no-cache" }
      ]
    }
  ]
}


A-4) 정적 프론트 + 서버리스 API(api/ 디렉토리)

{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "regions": ["icn1", "hnd1"],
  "functionFailoverRegion": "hnd1",
  "functions": {
    "api/*.ts": { "runtime": "nodejs20.x", "memory": 1024, "maxDuration": 10 }
  },
  "rewrites": [
    { "source": "/api/(.*)", "destination": "/api/$1" },
    { "source": "/assets/(.*)", "destination": "/assets/$1" },
    { "source": "/(.*)", "destination": "/index.html" }
  ],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        { "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }
      ]
    }
  ]
}


이미지·보안 헤더 옵션(선택)

{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        { "key": "X-Content-Type-Options", "value": "nosniff" },
        { "key": "Referrer-Policy", "value": "strict-origin-when-cross-origin" },
        { "key": "Permissions-Policy", "value": "geolocation=(), microphone=()" }
      ]
    }
  ],
  "images": {
    "domains": ["images.example.com"],
    "sizes": [320, 640, 960, 1200]
  }
}


예약 실행(크론, 선택)

{
  "crons": [
    { "path": "/api/cleanup", "schedule": "0 15 * * *" }
  ]
}


점검 체크리스트
buildCommand와 outputDirectory가 실제와 일치해야 합니다.
SPA는 정적 자산 예외 → 최종 index.html 리라이트 순서가 중요합니다.
HTML은 no-cache, 번들 자산은 immutable 장기 캐시가 안전합니다.
지역은 icn1/hnd1, 장애 조치는 functionFailoverRegion으로 보완합니다.

B. 하이브리드 앱용 Vercel 가이드

설명 포인트

하이브리드 앱의 웹 번들(dist)은 Vercel에서 호스팅합니다.

동일 번들을 Capacitor가 iOS/Android에 탑재합니다.

웹 번들은 PWA 특성을 갖도록 서비스워커와 매니페스트를 포함합니다.

모바일 앱의 딥링크·공유 URL은 같은 호스트에서 정상 라우팅되도록 rewrites를 둡니다.

전제 디렉토리
앱 프런트는 app/ 아래에 두고, 빌드 산출물은 app/dist를 사용합니다.

PWA 헤더 보완
서비스워커, 매니페스트, 아이콘 경로는 공개되어야 합니다.

{
  "headers": [
    {
      "source": "/manifest.webmanifest",
      "headers": [{ "key": "Content-Type", "value": "application/manifest+json" }]
    },
    {
      "source": "/(service-worker\\.js|sw\\.js)",
      "headers": [
        { "key": "Cache-Control", "value": "no-cache" }
      ]
    }
  ]
}


하이브리드 앱용 기본 vercel.json
webDir가 dist인 정적 번들을 SPA로 서빙하고, 자산 캐시와 PWA 파일을 노출합니다. api/가 있으면 그대로 함께 배포됩니다.

{
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "cleanUrls": true,
  "regions": ["icn1", "hnd1"],
  "functionFailoverRegion": "hnd1",
  "rewrites": [
    { "source": "/assets/(.*)", "destination": "/assets/$1" },
    { "source": "/(service-worker\\.js|manifest\\.webmanifest|favicon\\.ico)", "destination": "/$1" },
    { "source": "/api/(.*)", "destination": "/api/$1" },
    { "source": "/(.*)", "destination": "/index.html" }
  ],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        { "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }
      ]
    },
    {
      "source": "/(.*).html",
      "headers": [
        { "key": "Cache-Control", "value": "no-cache" }
      ]
    },
    {
      "source": "/(service-worker\\.js)",
      "headers": [
        { "key": "Cache-Control", "value": "no-cache" }
      ]
    },
    {
      "source": "/(.*)",
      "headers": [
        { "key": "X-Content-Type-Options", "value": "nosniff" },
        { "key": "Referrer-Policy", "value": "strict-origin-when-cross-origin" }
      ]
    }
  ],
  "functions": {
    "api/*.ts": { "runtime": "nodejs20.x", "memory": 1024, "maxDuration": 10 }
  }
}


서브패스 운영(선택)
앱 웹번들을 /app 경로 아래로 서빙할 때의 예입니다.

{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "rewrites": [
    { "source": "/app/assets/(.*)", "destination": "/assets/$1" },
    { "source": "/app/(service-worker\\.js|manifest\\.webmanifest|favicon\\.ico)", "destination": "/$1" },
    { "source": "/app/(.*)", "destination": "/index.html" }
  ]
}


딥링크 및 공유 URL 전략
모바일 앱에서 외부 링크를 열 때 SPA 경로가 그대로 공유됩니다. 위 rewrites로 모든 경로가 index.html로 진입하므로 라우터가 자체적으로 화면을 복원합니다.

캐시 전략
번들 자산은 immutable 1년, HTML/서비스워커는 no-cache가 안전합니다. 서비스워커 버전 변경 시 파일명을 변경하거나 내부 캐시 키를 갱신해 강제 업데이트합니다.

운영 체크리스트
Capacitor의 webDir는 dist여야 합니다.
상대 경로를 유지합니다.
API가 있으면 functions 설정과 regions를 맞춥니다.
앱 아이콘·스플래시는 네이티브 플랫폼에서 별도 관리합니다.

C. 적용 순서 제안

1단계: 로컬 빌드 확인
npm run build로 dist 생성 확인, 정적 자산이 dist/assets 아래에 있는지 점검합니다.

2단계: 템플릿 선택
웹은 A-2 또는 A-3, 정적 사이트면 A-1, API 포함이면 A-4를 적용합니다. 하이브리드 앱 웹번들은 B-3를 적용합니다.

3단계: Vercel 프로젝트 설정
Project Settings의 Build & Output이 vercel.json과 충돌하지 않는지 확인합니다. 빌드 명령과 출력 폴더는 vercel.json 기준으로 통일합니다.

4단계: 지역 및 캐시 미세 조정
한국 사용자가 중심이면 regions를 icn1 우선으로, 장애 조치는 functionFailoverRegion을 hnd1로 둡니다. 이미지 도메인 화이트리스트나 보안 헤더가 필요하면 추가합니다.

5단계: 동작 검증
로컬 vercel dev 또는 vercel --prod로 예행 검증 후 Git 연동 배포합니다. SPA 새로고침, 정적 자산 캐시, PWA 설치 동작을 확인합니다.